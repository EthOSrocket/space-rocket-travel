<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perjalanan Roket Luar Angkasa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- Tone.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a2a; /* Warna latar belakang gelap */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Sembunyikan scrollbar */
        }
        canvas {
            background-color: #000; /* Latar belakang hitam untuk kanvas */
            display: block;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5); /* Efek cahaya neon */
            max-width: 95vw; /* Lebar maksimum responsif */
            max-height: 95vh; /* Tinggi maksimum responsif */
        }
        .game-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-color: #1a1a3a;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.7);
        }
        .game-info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 10;
        }
        .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            border-radius: 15px;
            z-index: 20;
            display: none; /* Sembunyikan secara default */
        }
        .game-over-screen h1 {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        .game-over-screen button {
            padding: 12px 25px;
            background: linear-gradient(90deg, #00f, #0af); /* Gradient biru */
            color: #fff;
            border: none;
            border-radius: 30px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }
        .game-over-screen button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 255, 255, 0.6);
        }
        .eth {
            color: #000;
            -webkit-text-stroke: 1px #fff; /* Outline putih untuk Eth */
            text-stroke: 1px #fff;
        }
        .os {
            color: #00f; /* Biru terang untuk OS */
        }
        .game-over-logo {
            margin-bottom: 20px;
            max-width: 150px; /* Sesuaikan ukuran logo */
            height: auto;
            border-radius: 10px; /* Sudut membulat untuk logo */
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5); /* Efek cahaya di sekitar logo */
        }
        .final-score {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #fff;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 21; /* Pastikan di atas elemen lain di layar game over */
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-info">Skor: <span id="score">0</span></div>
        <canvas id="gameCanvas"></canvas>
        <div id="gameOverScreen" class="game-over-screen">
            <img id="gameOverLogo" src="https://i.postimg.cc/qgKcMW3T/1000403812.jpg" alt="Game Over Logo" class="game-over-logo" onerror="this.onerror=null;this.src='https://placehold.co/150x150/000000/FFFFFF?text=Logo';">
            <h1><span class="eth">Eth</span><span class="os">OS</span></h1>
            <div class="final-score">Skor Akhir: <span id="finalScoreDisplay">0</span></div>
            <button id="restartButton">Mulai Ulang</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const restartButton = document.getElementById('restartButton');
        const gameOverLogo = document.getElementById('gameOverLogo'); // Dapatkan elemen logo
        const finalScoreDisplay = document.getElementById('finalScoreDisplay'); // Dapatkan elemen untuk skor akhir

        let animationFrameId; // Variabel untuk menyimpan ID requestAnimationFrame
        let audioContext; // Untuk Web Audio API (tetap digunakan untuk suara ledakan)
        let backgroundSynth; // Untuk backsound menggunakan Tone.js
        let backgroundLoop; // Untuk loop musik latar Tone.js
        let backgroundGain; // Untuk kontrol volume backsound Tone.js

        // Variabel untuk mengontrol kecepatan meteor
        let currentMeteorBaseSpeed = 2.5; // Kecepatan dasar awal meteor ditingkatkan
        let lastSpeedIncreaseScore = 0; // Skor terakhir saat kecepatan meteor ditingkatkan
        const speedIncreaseInterval = 40; // Interval skor untuk peningkatan kecepatan

        // Objek roket
        const rocket = {
            x: 0, // Akan diatur di resizeCanvas atau resetGame
            y: 0, // Akan diatur di resizeCanvas atau resetGame
            width: 50,
            height: 80,
            speed: 4, // Mengurangi kecepatan roket untuk mengurangi sensitivitas
            dx: 0,
            draw() {
                // Badan roket
                ctx.fillStyle = '#4A90E2'; // Biru terang
                ctx.beginPath();
                ctx.moveTo(this.x + this.width / 2, this.y); // Atas
                ctx.lineTo(this.x, this.y + this.height); // Kiri bawah
                ctx.lineTo(this.x + this.width, this.y + this.height); // Kanan bawah
                ctx.closePath();
                ctx.fill();

                // Jendela
                ctx.fillStyle = '#8ED1FC'; // Biru lebih terang
                ctx.beginPath();
                ctx.arc(this.x + this.width / 2, this.y + this.height * 0.3, 10, 0, Math.PI * 2);
                ctx.fill();

                // Sirip kiri
                ctx.fillStyle = '#2C5F9B'; // Biru gelap
                ctx.beginPath();
                ctx.moveTo(this.x, this.y + this.height * 0.7);
                ctx.lineTo(this.x - 15, this.y + this.height * 0.85);
                ctx.lineTo(this.x, this.y + this.height);
                ctx.closePath();
                ctx.fill();

                // Sirip kanan
                ctx.beginPath();
                ctx.moveTo(this.x + this.width, this.y + this.height * 0.7);
                ctx.lineTo(this.x + this.width + 15, this.y + this.height * 0.85);
                ctx.lineTo(this.x + this.width, this.y + this.height);
                ctx.closePath();
                ctx.fill();

                // Api roket
                ctx.fillStyle = '#FFD700'; // Kuning keemasan
                ctx.beginPath();
                ctx.moveTo(this.x + this.width * 0.3, this.y + this.height);
                ctx.lineTo(this.x + this.width * 0.7, this.y + this.height);
                ctx.lineTo(this.x + this.width / 2, this.y + this.height + 20 + Math.random() * 10); // Api berkedip
                ctx.closePath();
                ctx.fill();
            }
        };

        // Ukuran kanvas responsif
        function resizeCanvas() {
            canvas.width = window.innerWidth * 0.8; // 80% dari lebar jendela
            canvas.height = window.innerHeight * 0.8; // 80% dari tinggi jendela
            if (canvas.width > 800) canvas.width = 800; // Batasi lebar maksimum
            if (canvas.height > 600) canvas.height = 600; // Batasi tinggi maksimum
            // Perbarui posisi roket jika kanvas diubah ukurannya
            // Pastikan rocket sudah terdefinisi sebelum mengakses propertinya
            if (rocket) {
                rocket.x = canvas.width / 2 - rocket.width / 2;
                rocket.y = canvas.height - 100;
            }
        }

        window.addEventListener('resize', resizeCanvas);
        // Panggil resizeCanvas saat inisialisasi, tetapi pastikan rocket sudah ada
        // Initial call to resizeCanvas will now happen after rocket is defined
        // or through resetGame on window.onload.

        // Array meteor
        let meteors = [];
        let score = 0;
        let gameOver = false;
        let explosions = []; // Array untuk menyimpan efek ledakan aktif

        // Latar belakang nebula (gambar sederhana)
        function drawNebulaBackground() {
            const gradient = ctx.createRadialGradient(
                canvas.width / 2, canvas.height / 2, 50,
                canvas.width / 2, canvas.height / 2, Math.max(canvas.width, canvas.height) / 2
            );
            gradient.addColorStop(0, 'rgba(20, 0, 50, 0.8)'); // Pusat lebih gelap
            gradient.addColorStop(0.5, 'rgba(50, 0, 100, 0.6)'); // Ungu
            gradient.addColorStop(1, 'rgba(0, 0, 20, 0.4)'); // Pinggir lebih gelap
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Tambahkan bintang-bintang kecil
            for (let i = 0; i < 100; i++) {
                ctx.fillStyle = `rgba(255, 255, 255, ${Math.random()})`;
                ctx.beginPath();
                ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, Math.random() * 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Fungsi untuk membuat meteor baru
        function createMeteor() {
            const size = 20 + Math.random() * 30; // Ukuran meteor bervariasi
            // Kecepatan meteor baru berdasarkan currentMeteorBaseSpeed
            meteors.push({
                x: Math.random() * (canvas.width - size),
                y: -size, // Mulai dari atas kanvas
                width: size,
                height: size,
                speed: currentMeteorBaseSpeed + Math.random() * 3, // Kecepatan bervariasi dari base speed
                draw() {
                    ctx.fillStyle = '#8B4513'; // Coklat untuk meteor
                    ctx.beginPath();
                    // Bentuk meteor tidak beraturan
                    ctx.moveTo(this.x + this.width * 0.5, this.y);
                    ctx.lineTo(this.x + this.width, this.y + this.height * 0.3);
                    ctx.lineTo(this.x + this.width * 0.8, this.y + this.height);
                    ctx.lineTo(this.x + this.width * 0.2, this.y + this.height);
                    ctx.lineTo(this.x, this.y + this.height * 0.7);
                    ctx.closePath();
                    ctx.fill();

                    // Detail kawah kecil
                    ctx.fillStyle = '#654321';
                    ctx.beginPath();
                    ctx.arc(this.x + this.width * 0.3, this.y + this.height * 0.4, this.width * 0.1, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(this.x + this.width * 0.7, this.y + this.height * 0.7, this.width * 0.15, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
        }

        // Fungsi untuk memainkan suara ledakan
        function playExplosionSound() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sine'; // Tipe gelombang
            oscillator.frequency.setValueAtTime(100, audioContext.currentTime); // Frekuensi awal

            // Efek suara ledakan: frekuensi menurun cepat dan volume memudar
            oscillator.frequency.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            gainNode.gain.setValueAtTime(2.0, audioContext.currentTime); // Volume ledakan ditingkatkan menjadi 2.0
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5); // Berhenti setelah 0.5 detik
        }

        // Fungsi untuk memulai backsound instrumental menggunakan Tone.js
        async function startBackgroundMusic() {
            // Pastikan AudioContext diinisialisasi setelah interaksi pengguna
            // Tone.start() akan menangani inisialisasi AudioContext dengan benar
            await Tone.start();
            console.log("AudioContext is running");

            // Hentikan musik jika sudah dimainkan sebelumnya
            if (backgroundLoop) {
                backgroundLoop.stop();
                backgroundSynth.dispose(); // Bersihkan synth sebelumnya
                backgroundGain.dispose(); // Bersihkan gain sebelumnya
            }

            // Buat synth (AmSynth cocok untuk suara ambient)
            backgroundSynth = new Tone.AMSynth({
                harmonicity: 2,
                oscillator: {
                    type: "sine"
                },
                envelope: {
                    attack: 0.5,
                    decay: 0.1,
                    sustain: 0.9,
                    release: 1
                },
                modulation: {
                    type: "square"
                },
                modulationEnvelope: {
                    attack: 0.5,
                    decay: 0,
                    sustain: 1,
                    release: 0.5
                }
            }).toDestination();

            // Atur volume global untuk backsound
            backgroundGain = new Tone.Gain(0.2).toDestination(); // Volume ditingkatkan dari 0.05 ke 0.2
            backgroundSynth.connect(backgroundGain);

            // Buat loop untuk memutar nada ambient
            const notes = ["C3", "E3", "G3", "C4"]; // Contoh akor C Mayor
            let noteIndex = 0;

            backgroundLoop = new Tone.Loop(time => {
                // Mainkan nada dari akor secara berurutan atau acak
                backgroundSynth.triggerAttackRelease(notes[noteIndex % notes.length], "2n", time);
                noteIndex++;
            }, "4n").start(0); // Ulangi setiap 4 nada (setiap 1 detik jika tempo default 120 bpm)

            Tone.Transport.start(); // Mulai transport Tone.js
        }

        // Fungsi untuk menghentikan backsound
        function stopBackgroundMusic() {
            if (backgroundLoop) {
                backgroundLoop.stop();
                backgroundLoop.dispose();
                backgroundLoop = null;
            }
            if (backgroundSynth) {
                backgroundSynth.dispose();
                backgroundSynth = null;
            }
            if (backgroundGain) {
                backgroundGain.dispose();
                backgroundGain = null;
            }
            Tone.Transport.stop(); // Hentikan transport Tone.js
        }

        // Fungsi untuk membuat efek ledakan visual
        function createExplosion(x, y) {
            explosions.push({
                x: x,
                y: y,
                radius: 10,
                alpha: 1,
                maxRadius: 60,
                speed: 3,
                color: ['#FFA500', '#FF4500', '#FFD700'] // Oranye, Merah Oranye, Emas
            });
        }

        // Fungsi untuk menggambar dan memperbarui efek ledakan
        function drawExplosions() {
            for (let i = explosions.length - 1; i >= 0; i--) {
                let exp = explosions[i];

                ctx.save();
                ctx.globalAlpha = exp.alpha;

                for (let j = 0; j < exp.color.length; j++) {
                    ctx.fillStyle = exp.color[j];
                    ctx.beginPath();
                    ctx.arc(exp.x, exp.y, exp.radius * (1 - j * 0.2), 0, Math.PI * 2); // Beberapa lingkaran
                    ctx.fill();
                }

                ctx.restore();

                exp.radius += exp.speed;
                exp.alpha -= 0.03; // Memudar

                if (exp.alpha <= 0 || exp.radius > exp.maxRadius) {
                    explosions.splice(i, 1); // Hapus ledakan yang sudah selesai
                }
            }
        }

        // Fungsi untuk memperbarui posisi objek
        function update() {
            if (gameOver) return;

            // Perbarui posisi roket
            rocket.x += rocket.dx;

            // Batasi roket agar tidak keluar dari kanvas
            if (rocket.x < 0) {
                rocket.x = 0;
            }
            if (rocket.x + rocket.width > canvas.width) {
                rocket.x = canvas.width - rocket.width;
            }

            // Perbarui posisi meteor
            meteors.forEach((meteor, index) => {
                meteor.y += meteor.speed;

                // Hapus meteor yang sudah keluar dari layar dan tambahkan skor
                if (meteor.y > canvas.height) {
                    meteors.splice(index, 1);
                    score++;
                    scoreDisplay.textContent = score;

                    // Cek apakah skor mencapai kelipatan `speedIncreaseInterval` dan bukan skor yang sama dengan peningkatan terakhir
                    if (score > 0 && score % speedIncreaseInterval === 0 && score !== lastSpeedIncreaseScore) {
                        currentMeteorBaseSpeed += 0.5; // Tingkatkan kecepatan dasar untuk meteor baru
                        lastSpeedIncreaseScore = score; // Perbarui skor terakhir peningkatan kecepatan

                        // Tingkatkan kecepatan meteor yang sudah ada di layar
                        meteors.forEach(existingMeteor => {
                            existingMeteor.speed += 0.5;
                        });
                        console.log(`Kecepatan meteor ditingkatkan! Skor: ${score}, Kecepatan dasar baru: ${currentMeteorBaseSpeed}`);
                    }
                }

                // Deteksi tabrakan
                if (
                    rocket.x < meteor.x + meteor.width &&
                    rocket.x + rocket.width > meteor.x &&
                    rocket.y < meteor.y + meteor.height &&
                    rocket.y + rocket.height > meteor.y
                ) {
                    gameOver = true;
                    createExplosion(rocket.x + rocket.width / 2, rocket.y + rocket.height / 2); // Buat ledakan di posisi roket
                    playExplosionSound(); // Mainkan suara ledakan
                    stopBackgroundMusic(); // Hentikan backsound saat game over
                    cancelAnimationFrame(animationFrameId); // Hentikan loop animasi
                    
                    // Tunda tampilan game over screen agar ledakan terlihat
                    setTimeout(() => {
                        gameOverScreen.style.display = 'flex';
                        gameOverLogo.style.display = 'block'; // Tampilkan logo saat game over
                        finalScoreDisplay.textContent = score; // Perbarui skor akhir
                    }, 500); // Tunda 0.5 detik
                }
            });

            // Tambahkan meteor baru secara berkala
            if (Math.random() < 0.02) { // Frekuensi munculnya meteor
                createMeteor();
            }
        }

        // Fungsi untuk menggambar semua objek
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Bersihkan kanvas
            drawNebulaBackground(); // Gambar latar belakang nebula
            if (!gameOver) { // Jangan gambar roket jika game over (agar ledakan terlihat)
                rocket.draw(); // Gambar roket
            }
            meteors.forEach(meteor => meteor.draw()); // Gambar meteor
            drawExplosions(); // Gambar ledakan aktif
        }

        // Loop utama game
        function gameLoop() {
            update();
            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // Penanganan input keyboard
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowLeft' || e.key === 'a') {
                rocket.dx = -rocket.speed;
            } else if (e.key === 'ArrowRight' || e.key === 'd') {
                rocket.dx = rocket.speed;
            }
        });

        document.addEventListener('keyup', e => {
            if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'ArrowRight' || e.key === 'd') {
                rocket.dx = 0;
            }
        });

        // Penanganan input sentuh (swipe)
        let touchStartX = 0;
        canvas.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });

        canvas.addEventListener('touchmove', e => {
            const touchCurrentX = e.touches[0].clientX;
            const diffX = touchCurrentX - touchStartX;

            if (diffX > 0) {
                rocket.dx = rocket.speed; // Geser ke kanan
            } else if (diffX < 0) {
                rocket.dx = -rocket.speed; // Geser ke kiri
            }
            touchStartX = touchCurrentX; // Perbarui posisi awal sentuhan
        });

        canvas.addEventListener('touchend', () => {
            rocket.dx = 0; // Hentikan gerakan saat sentuhan berakhir
        });


        // Fungsi untuk mereset game
        async function resetGame() { // Menjadikan fungsi async
            // Pastikan canvas sudah memiliki ukuran yang benar sebelum mengatur posisi roket
            resizeCanvas();
            rocket.x = canvas.width / 2 - rocket.width / 2;
            rocket.y = canvas.height - 100;
            rocket.dx = 0;
            meteors = [];
            score = 0;
            scoreDisplay.textContent = score;
            gameOver = false;
            explosions = []; // Bersihkan ledakan yang tersisa
            gameOverScreen.style.display = 'none';
            // Sembunyikan logo saat game dimulai ulang
            gameOverLogo.style.display = 'none';
            
            // Memastikan AudioContext dimulai dengan interaksi pengguna
            await Tone.start(); // Pastikan AudioContext dimulai
            startBackgroundMusic(); // Mulai backsound saat game dimulai
            gameLoop(); // Mulai ulang loop game
        }

        restartButton.addEventListener('click', resetGame);

        // Saat jendela dimuat, tampilkan layar game over terlebih dahulu
        // agar pengguna bisa mengklik "Mulai Ulang" untuk memulai game dan audio.
        window.onload = function () {
            resizeCanvas(); // Pastikan kanvas diatur ukurannya
            gameOverScreen.style.display = 'flex'; // Tampilkan layar game over
            gameOverLogo.style.display = 'block'; // Tampilkan logo
            finalScoreDisplay.textContent = 0; // Atur skor akhir ke 0 saat pertama kali dimuat
            // Jangan panggil resetGame() di sini agar audio tidak otomatis dimulai
        }
    </script>
</body>
</html>
